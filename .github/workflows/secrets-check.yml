name: Secrets Check

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  check-secrets:
    runs-on: ubuntu-latest
    env:
      CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}
      FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
      GHCR_TOKEN: ${{ secrets.GHCR_TOKEN }}
      GHCR_USERNAME: ${{ secrets.GHCR_USERNAME }}
      SSH_HOST: ${{ secrets.SSH_HOST }}
      SSH_USER: ${{ secrets.SSH_USER }}
      SSH_KEY: ${{ secrets.SSH_KEY }}
      SSH_PORT: ${{ secrets.SSH_PORT }}
      SSH_HOST_STAGING: ${{ secrets.SSH_HOST_STAGING }}
      SSH_USER_STAGING: ${{ secrets.SSH_USER_STAGING }}
      SSH_KEY_STAGING: ${{ secrets.SSH_KEY_STAGING }}
      SSH_PORT_STAGING: ${{ secrets.SSH_PORT_STAGING }}
      TEST_EMAIL: ${{ secrets.TEST_EMAIL }}
      TEST_PASSWORD: ${{ secrets.TEST_PASSWORD }}
      VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
    steps:
      - name: Evaluate Secrets Presence
        run: |
          set -euo pipefail
          missing=()
          check() { var="$1"; val="${!1:-}"; if [ -z "$val" ]; then missing+=("$var"); fi }
          for key in \
            CODECOV_TOKEN FLY_API_TOKEN GHCR_TOKEN GHCR_USERNAME \
            SSH_HOST SSH_USER SSH_KEY SSH_PORT \
            SSH_HOST_STAGING SSH_USER_STAGING SSH_KEY_STAGING SSH_PORT_STAGING \
            TEST_EMAIL TEST_PASSWORD VERCEL_TOKEN; do
            check "$key"
          done
          if [ ${#missing[@]} -gt 0 ]; then
            echo "Missing required secrets:" >&2
            printf ' - %s\n' "${missing[@]}" >&2
            exit 1
          fi
          echo "All required secrets are present."
