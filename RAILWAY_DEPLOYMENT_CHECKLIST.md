# üöÄ Railway Deployment Execution Checklist

**Date:** December 31, 2025  
**Deploying:** Infamous Freight Enterprises API v2.0.0  
**Platform:** Railway.app  
**Target URL:** TBD (will be generated by Railway)

---

## ‚úÖ Pre-Deployment Checklist

- [x] All tests passing (79+ tests)
- [x] Coverage targets met (91-94% for core services)
- [x] Code committed and pushed to GitHub (commit: 26fb08a)
- [x] Web app deployed to Vercel (https://infamous-freight-enterprises-git-f34b9b-santorio-miles-projects.vercel.app)
- [x] Railway deployment guide created (RAILWAY_DEPLOY_IPHONE.md)
- [ ] Environment variables prepared
- [ ] Database migration plan ready

---

## üìã Deployment Steps

### 1. Access Railway Dashboard

- [ ] Open Safari on iPhone
- [ ] Navigate to https://railway.app
- [ ] Login with GitHub (MrMiless44 account)

### 2. Create New Project

- [ ] Tap "New Project"
- [ ] Select "Deploy from GitHub repo"
- [ ] Choose `MrMiless44/Infamous-freight-enterprises`
- [ ] Wait for Railway to analyze repository

### 3. Configure API Service

- [ ] Tap on the service Railway created
- [ ] Go to Settings tab
- [ ] Set Root Directory: `src/apps/api`
- [ ] Set Build Command: `pnpm install && pnpm build`
- [ ] Set Start Command: `node src/server.js`
- [ ] Set Port: 4000 (or use Railway default)

### 4. Add PostgreSQL Database

- [ ] Tap "+ New" button in project
- [ ] Select "Database" ‚Üí "Add PostgreSQL"
- [ ] Wait for provisioning (~30 seconds)
- [ ] Verify `DATABASE_URL` is auto-added to variables

### 5. Configure Environment Variables

Copy these to Railway Variables tab:

```env
NODE_ENV=production
PORT=${{RAILWAY_PORT}}
DATABASE_URL=${{DATABASE_URL}}
JWT_SECRET=<GENERATE_STRONG_SECRET>
CORS_ORIGINS=https://infamous-freight-enterprises-git-f34b9b-santorio-miles-projects.vercel.app
AI_PROVIDER=synthetic
LOG_LEVEL=info
SENTRY_DSN=<IF_USING_SENTRY>
```

**Required Actions:**

- [ ] Generate JWT_SECRET (use: https://generate-secret.vercel.app/32)
- [ ] Copy JWT_SECRET and save securely
- [ ] Add all environment variables
- [ ] Verify DATABASE_URL is present

### 6. Run Database Migrations

- [ ] Once deployed, open Railway service logs
- [ ] Check for successful database connection
- [ ] Run migrations via Railway CLI or manual Prisma commands
  - Option A: Add to build command: `pnpm prisma:migrate:deploy`
  - Option B: Run from local: `DATABASE_URL=<railway-url> pnpm prisma:migrate:deploy`

### 7. Deploy & Monitor

- [ ] Tap "Deploy" or wait for auto-deploy
- [ ] Monitor deployment logs for errors
- [ ] Check build completes successfully
- [ ] Verify service starts without errors
- [ ] Note the generated Railway URL (e.g., `*.up.railway.app`)

### 8. Test Deployed API

- [ ] Open Railway URL in browser
- [ ] Test health endpoint: `GET https://<railway-url>/api/health`
- [ ] Expected response: `{"status":"ok","uptime":...}`
- [ ] Test from web app (update `NEXT_PUBLIC_API_URL` in Vercel)

### 9. Update Web App Configuration

- [ ] Go to Vercel dashboard
- [ ] Open project settings
- [ ] Add environment variable: `NEXT_PUBLIC_API_URL=https://<railway-url>`
- [ ] Redeploy web app
- [ ] Test full integration (web ‚Üí API ‚Üí database)

### 10. Post-Deployment Verification

- [ ] Check API health endpoint responds
- [ ] Verify database connection works
- [ ] Test authentication endpoints
- [ ] Test GPS tracking endpoints
- [ ] Test route optimizer endpoints
- [ ] Monitor Railway logs for errors
- [ ] Check Railway metrics dashboard

---

## üîß Troubleshooting

### Build Fails

- **Issue:** `pnpm: not found`
- **Fix:** Railway should auto-detect pnpm from `package.json` engines field
- **Alternative:** Use `npm install && npm run build`

### Database Connection Fails

- **Issue:** `Can't connect to database`
- **Fix:** Verify `DATABASE_URL` is set correctly
- **Check:** Railway PostgreSQL service is running
- **Format:** `postgresql://user:pass@host:port/db?sslmode=require`

### Port Binding Errors

- **Issue:** `Port 4000 already in use`
- **Fix:** Use Railway's `${{RAILWAY_PORT}}` variable instead
- **Update:** `PORT=${{RAILWAY_PORT}}` in environment

### CORS Errors

- **Issue:** Web app can't reach API
- **Fix:** Add web app URL to `CORS_ORIGINS`
- **Format:** Comma-separated, no trailing slashes

### JWT Authentication Fails

- **Issue:** `Invalid token` errors
- **Fix:** Ensure `JWT_SECRET` matches between deploys
- **Note:** Changing secret invalidates all existing tokens

---

## üìä Post-Deployment Metrics

Record these after successful deployment:

- **Deployment Date/Time:** **\*\*\*\***\_**\*\*\*\***
- **Railway URL:** **\*\*\*\***\_**\*\*\*\***
- **Database Host:** **\*\*\*\***\_**\*\*\*\***
- **Average Response Time:** \***\*\_\*\*** ms
- **Build Time:** \***\*\_\*\*** seconds
- **Initial Memory Usage:** \***\*\_\*\*** MB
- **Initial CPU Usage:** \***\*\_\*\*** %

---

## üîó Important URLs

- **GitHub Repo:** https://github.com/MrMiless44/Infamous-freight-enterprises
- **Railway Dashboard:** https://railway.app/dashboard
- **Web App (Vercel):** https://infamous-freight-enterprises-git-f34b9b-santorio-miles-projects.vercel.app
- **API Deployed URL:** **\*\*\*\***\_**\*\*\*\*** (fill after deployment)
- **Database Dashboard:** **\*\*\*\***\_**\*\*\*\*** (from Railway)

---

## üìù Notes

- Railway free tier includes: 500 hours/month, $5 credit
- Database backups are automatic on paid plans
- Logs retained for 7 days on free tier
- Custom domains require paid plan
- Monitor usage to avoid overages

---

## ‚úÖ Deployment Complete

Once all steps above are checked, your API is live! üéâ

**Next Steps:**

1. Monitor Railway dashboard for 24-48 hours
2. Check error rates and response times
3. Set up alerts for downtime (if on paid plan)
4. Document API URL in project README
5. Update CORS settings if adding more frontends
